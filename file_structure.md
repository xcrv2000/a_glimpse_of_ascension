# 项目文件结构与关系图

## 项目结构

```
a_glimpse_of_ascension/
├── public/              # 存放HTML文件和其他静态资源
│   ├── index.html       # 首页
│   ├── chat.html        # 游戏聊天页面
│   └── settings.html    # 设置页面
├── src/                 # 存放源代码
│   ├── js/              # JavaScript文件
│   │   ├── engine.js               # 游戏引擎核心
│   │   ├── dataManager.js          # 数据管理模块
│   │   ├── responseParser.js       # 响应解析模块
│   │   ├── storyStorage.js         # 故事存储管理
│   │   ├── promptBuilder_storyteller.js  # 提示词构建器
│   │   └── contextCompressor.js    # 上下文压缩器
│   └── data/            # 数据文件
│       ├── data.json               # 游戏数据
│       ├── compressed_context.json # 压缩的上下文
│       └── prompt.json             # 提示词配置
├── .trae/               # 现有文件夹，保持不变
├── .gitattributes       # 现有文件，保持不变
├── Readme.txt           # 现有文件，保持不变
└── todo_follow_up.md    # 现有文件，保持不变
```

## 文件关系图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           项目根目录                                   │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│                 │                 │                 │                 │
▼                 ▼                 ▼                 ▼                 ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   public/   │ │    src/    │ │   .trae/    │ │ Readme.txt  │ │ todo_follow_│
└─────┬──────┘ └────┬────────┘ └─────────────┘ └─────────────┘ │    up.md    │
      │             │                                          └─────────────┘
┌─────▼──────┐ ┌────▼────────┐ ┌─────────────┐
│HTML文件    │ │   js/       │ │   data/     │
└────────────┘ └────┬────────┘ └────┬────────┘
                    │               │
┌───────────────────▼───────────────▼──────────────────────┐
│                      核心模块关系                       │
└──────────────────────────────────────────────────────────┘

核心模块依赖关系：
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│  engine.js      │◄─────┤ dataManager.js  │◄─────┤   data.json     │
└─────────┬───────┘      └─────────────────┘      └─────────────────┘
          │
          │      ┌─────────────────┐      ┌─────────────────┐
          └──────┤responseParser.js│      │   prompt.json   │
                 └─────────────────┘      └────────┬────────┘
                                                  │
┌─────────────────┐      ┌─────────────────┐      │
│contextCompressor.js◄────┤promptBuilder_  │◄─────┘
└─────────────────┘      │storyteller.js   │
                         └─────────────────┘

┌─────────────────┐
│storyStorage.js  │
└─────────────────┘

HTML文件引用关系：
┌─────────────────┐      ┌─────────────────┐
│  index.html     │──────┤ storyStorage.js │
└─────────────────┘      └─────────────────┘

┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   chat.html     │──────┤ 所有JS模块      │──────┤ 所有数据文件    │
└─────────────────┘      └─────────────────┘      └─────────────────┘
```

## 模块功能说明

### HTML文件
- **index.html**：游戏首页，显示游戏标题和开始按钮
- **chat.html**：游戏聊天界面，实现与AI的对话功能
- **settings.html**：游戏设置页面，配置API密钥等

### JavaScript模块
- **engine.js**：游戏引擎核心，处理AI响应和游戏逻辑
- **dataManager.js**：数据管理模块，负责读写游戏数据
- **responseParser.js**：响应解析模块，解析AI的响应内容
- **storyStorage.js**：故事存储管理，存储和加载故事数据
- **promptBuilder_storyteller.js**：提示词构建器，准备API请求数据
- **contextCompressor.js**：上下文压缩器，压缩过长的对话上下文

### 数据文件
- **data.json**：游戏数据，存储游戏状态和配置
- **compressed_context.json**：压缩的上下文数据
- **prompt.json**：AI提示词配置

## 项目流程

1. **启动流程**：用户访问index.html → 点击开始游戏 → 进入chat.html
2. **游戏流程**：用户输入消息 → 发送到AI → AI返回响应 → 游戏引擎处理响应 → 更新游戏状态 → 显示给用户
3. **数据流程**：游戏引擎 → 数据管理器 → 数据文件/本地存储 → 游戏引擎

## 技术特点

1. **模块化设计**：将不同功能分离到独立的模块中
2. **本地存储**：使用localStorage存储游戏数据
3. **API集成**：集成DeepSeek API实现AI对话
4. **上下文管理**：自动压缩过长的对话上下文
5. **调试功能**：提供调试面板显示API请求和响应

## 注意事项

1. **路径引用**：所有文件引用路径已更新为新的文件夹结构
2. **数据存储**：在浏览器环境中，数据存储在localStorage中
3. **API密钥**：需要在settings.html中配置DeepSeek API密钥
4. **上下文压缩**：当对话过长时会自动压缩上下文，保持API请求在合理长度