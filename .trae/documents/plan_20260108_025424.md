# 事件注册功能实现计划

## 1. 数据结构设计
- 在 `data.json` 中添加 `events` 数组，存储事件信息
- 每个事件包含：
  - `id`: 唯一标识符
  - `description`: 事件描述
  - `characters`: 参与角色
  - `startTime`: 事件开始时间
  - `expectedEndTime`: 预期结束时间
  - `status`: 当前状态（active/completed/cancelled）
  - `createdAt`: 创建时间
  - `updatedAt`: 更新时间

## 2. 响应解析器扩展
- 在 `responseParser.js` 中：
  - 扩展 `allowedPaths` 数组，添加事件相关路径
  - 支持事件的 CRUD 操作
  - 新增事件操作的解析格式，如：
    - `事件操作：创建`
    - `事件操作：更新`
    - `事件操作：删除`

## 3. 引擎核心逻辑
- 在 `engine.js` 中添加：
  - `processEventOperation` 方法处理事件操作
  - `checkExpiredEvents` 方法检查过期事件
  - 在 `processAIResponse` 中集成事件检查
  - 实现事件的创建、更新、删除逻辑
  - 实现事件过期检测和处理

## 4. 事件管理功能
- **事件创建**：AI 生成事件描述、参与角色、开始时间和预期结束时间
- **事件更新**：AI 可以更新事件状态、描述、预期结束时间等
- **事件删除**：AI 可以删除不需要的事件
- **事件过期处理**：当事件预期结束时间到来时，触发 AI 提及该事件，并在未更新时自动注销

## 5. Prompt 集成
- 在 prompt 中添加事件机制说明：
  - 事件注册的基本逻辑
  - 事件操作的格式和示例
  - 事件时间管理的最佳实践
  - 事件状态更新的时机和方法

## 6. 实现步骤
1. 更新 `dataManager.js`，添加事件相关的默认数据结构
2. 扩展 `responseParser.js`，支持事件操作解析
3. 实现 `engine.js` 中的事件管理逻辑
4. 更新 `data.json`，添加事件存储结构
5. 编写事件机制的 prompt 说明文档
6. 测试事件注册、更新、删除和过期处理功能