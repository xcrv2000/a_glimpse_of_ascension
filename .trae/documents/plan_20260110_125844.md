## 角色系统实现计划

### 1. 数据结构更新

#### 1.1 更新 data.json

* 添加 `characters` 数组到游戏数据结构

* 实现角色数据格式：

  ```json
  {
    "name": "角色名称",
    "memoryPoints": "记忆点描述",
    "description": "角色描述",
    "template": "角色模板",
    "relationship": "与玩家关系",
    "thingsDone": ["做过的事1", "做过的事2"]
  }
  ```

* 添加初始角色：特雷 (Trey)

  ```json
  {
    "name": "特雷",
    "memoryPoints": "头顶插着一个巨大的齿轮",
    "description": "开朗的新手向导和任务发布员",
    "template": "蝶",
    "relationship": "新手引导",
    "thingsDone": []
  }
  ```

#### 1.2 更新 lore.json

* 创建 12 个空白角色模板，作为 AI 生成角色的参考

* 模板格式：

  ```json
  {
    "template_id": "template1",
    "personality": "",
    "motivation": "",
    "behaviorPattern": ""
  }
  ```

### 2. 功能模块实现

#### 2.1 扩展 ResponseParser.js

* 添加角色操作解析：

  * `registerCharacter`: 注册新角色

  * `updateCharacter`: 更新现有角色

  * `deleteCharacter`: 删除角色

  * 快捷添加"做过的事"：`【角色，做过的事，添加】`格式解析

* 添加角色数据验证函数：

  * `validateCharacterRequest`: 验证角色数据格式

  * `validateDeleteCharacterRequest`: 验证角色删除请求

#### 2.2 扩展 GameEngine.js

* 添加角色管理方法：

  * `registerCharacter`: 注册新角色或更新同名角色

  * `updateCharacter`: 更新现有角色

  * `deleteCharacter`: 删除指定角色

  * `addCharacterThingDone`: 快捷添加角色"做过的事"

* 确保在游戏数据加载时初始化 `characters` 数组

#### 2.3 更新 prompt.json

* 添加角色系统文档：

  * 角色系统概述

  * 角色操作方法和格式

  * 角色字段说明

  * 角色使用指南

  * 角色操作示例

* 添加 AI 提醒：

  1. 尽可能多样化的创建角色

  2. 尽可能不要让角色超过 12 个

  3. 不重要的角色可以不记录到角色卡中

  4. 该功能也可以用于记录人群，但是记录人群时必须有一个或几个典型的人用于和玩家交互

### 3. 实现细节

#### 3.1 角色数据格式

* **name**: 角色名称（作为唯一标识）

* **memoryPoints**: 角色的外形特征、行为特征、口癖等

* **description**: 角色详细描述

* **template**: 角色模板（关联到 lore.json 中的模板）

* **relationship**: 角色与玩家的关系

* **thingsDone**: 角色做过的事（数组）

#### 3.2 角色操作格式

* 注册角色：`注册角色：{"name":"角色名称","memoryPoints":"记忆点","description":"描述","template":"模板","relationship":"关系","thingsDone":["做过的事1"]}`

* 更新角色：`更新角色：{"name":"角色名称","memoryPoints":"记忆点","description":"描述","template":"模板","relationship":"关系","thingsDone":["做过的事1","做过的事2"]}`

* 删除角色：`删除角色：角色名称`

* 快捷添加做过的事：`【角色名称，做过的事，添加】`

#### 3.3 集成与兼容性

* 确保与现有事件系统和伏笔系统的兼容性

* 保持数据结构的一致性和可扩展性

* 确保所有操作都有适当的错误处理

### 4. 测试与验证

* 测试角色注册、更新、删除操作

* 测试快捷添加"做过的事"功能

* 验证角色数据格式正确性

* 确保初始角色正确加载

* 测试与现有系统的集成

