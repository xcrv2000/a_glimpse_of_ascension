# Recorder 输出数据格式文档

## 1. 概述

本文档描述了故事记录者（Recorder）需要输出的数据格式，基于 `responseParser.js` 的解析规则。Recorder 的核心职责是解析故事内容并生成相应的游戏引擎操作指令，以更新游戏状态。

## 2. 输出数据类型

Recorder 可以输出以下类型的数据，这些数据将被 `responseParser` 解析并用于更新游戏状态：

### 2.1 节拍操作

节拍是故事发展的节奏单位，用于管理叙事节奏。

- **格式**：`节拍操作：维持/推进/完结(节拍)` 或 `维持/推进/完结(节拍)`
- **示例**：
  - `节拍操作：推进节拍`
  - `维持`
  - `完结`

### 2.2 景深等级

景深等级控制故事描述的详细程度，范围为 1-5。

- **格式**：`当前景深等级：2` 或 `景深等级：2`
- **示例**：`当前景深等级：3`
- **数值含义**：
  - 1：概览性描述，场景广阔
  - 2：中等细节，人物和环境
  - 3：详细描述，人物动作和对话
  - 4：特写镜头，情感和细节
  - 5：内心活动，深度心理描写

### 2.3 时间设置

直接设置故事当前时间。

- **格式**：`当前时间：[时间描述]`
- **示例**：`当前时间：1925-12-26 01:30:00`

### 2.4 时间推进

根据描述推进故事时间。

- **格式**：`推进时间：[时间描述]`
- **示例**：
  - `推进时间：1小时零5分钟`
  - `推进时间：2天3小时`
  - `推进时间：30分钟`
- **支持的时间单位**：天/日、小时/时、分钟/分、秒

### 2.5 事件操作

管理故事中的事件。

#### 注册事件
- **格式**：`注册事件：{"name":"事件名称","description":"事件描述","expectedEndTime":"预期结束时间","status":"foreground/background","importance":3,"participants":["参与角色1","参与角色2"]}`
- **示例**：`注册事件：{"name":"神秘会议","description":"主角参加了一个神秘会议","expectedEndTime":"1925-12-26 23:00:00","status":"foreground","importance":3,"participants":["主角","神秘人"]}`

#### 更新事件
- **格式**：`更新事件：{"name":"事件名称","description":"事件描述","expectedEndTime":"预期结束时间","status":"foreground/background","importance":3,"participants":["参与角色1","参与角色2"]}`
- **示例**：`更新事件：{"name":"神秘会议","description":"主角参加了一个神秘会议，了解了重要信息","expectedEndTime":"1925-12-26 23:00:00","status":"foreground","importance":4,"participants":["主角","神秘人"]}`

#### 删除事件
- **格式**：`删除事件：事件名称`
- **示例**：`删除事件：神秘会议`

### 2.6 伏笔操作

管理故事中的伏笔，用于记录未解决的线索。

#### 添加伏笔
- **格式**：`添加伏笔：{"name":"伏笔名称","description":"伏笔描述","occurrenceTime":"发生时间","importance":3,"metadata":{"key":"value"}}`
- **示例**：`添加伏笔：{"name":"神秘符号","description":"主角发现了一个神秘符号","occurrenceTime":"1925-12-26","importance":3,"metadata":{"location":"地下室"}}`

#### 更新伏笔
- **格式**：`更新伏笔：{"name":"伏笔名称","description":"伏笔描述","importance":3,"metadata":{"key":"value"}}`
- **示例**：`更新伏笔：{"name":"神秘符号","description":"主角发现了一个神秘符号，似乎与古老文明有关","importance":4,"metadata":{"location":"地下室","type":"古老文明"}}`

#### 删除伏笔
- **格式**：`删除伏笔：伏笔名称`
- **示例**：`删除伏笔：神秘符号`

### 2.7 角色操作

管理游戏中的角色。

#### 注册角色
- **格式**：`注册角色：{"name":"角色名称","description":"角色描述",...其他属性}`
- **示例**：`注册角色：{"name":"主角","description":"故事的主人公","gender":"男","age":25,"occupation":"侦探"}`

#### 更新角色
- **格式**：`更新角色：{"name":"角色名称","description":"角色描述",...其他属性}`
- **示例**：`更新角色：{"name":"主角","description":"故事的主人公，已经发现了重要线索","gender":"男","age":25,"occupation":"侦探"}`

#### 删除角色
- **格式**：`删除角色：角色名称`
- **示例**：`删除角色：次要角色`

#### 添加角色做过的事
- **格式**：`添加角色做过的事：角色名称，做过的事`
- **示例**：`添加角色做过的事：主角，发现了神秘符号`

### 2.8 物品/资产/知识/地点操作

管理游戏中的各种资产。

#### 添加物品
- **格式**：`添加物品：{"name":"物品名称","description":"物品描述","owner":"所属者"}`
- **示例**：`添加物品：{"name":"神秘钥匙","description":"一把古老的钥匙","owner":"主角"}`

#### 添加资产
- **格式**：`添加资产：{"name":"资产名称","description":"资产描述","owner":"所属者"}`
- **示例**：`添加资产：{"name":"老旧房屋","description":"主角继承的老旧房屋","owner":"主角"}`

#### 添加知识
- **格式**：`添加知识：{"name":"知识名称","description":"知识描述","owner":"所属者"}`
- **示例**：`添加知识：{"name":"古老符号学","description":"关于古老符号的知识","owner":"主角"}`

#### 添加地点
- **格式**：`添加地点：{"name":"地点名称","description":"地点描述","owner":"所属者"}`
- **示例**：`添加地点：{"name":"神秘地下室","description":"位于老旧房屋下方的神秘地下室","owner":"主角"}`

#### 更新物品/资产/知识/地点
- **格式**：`更新物品/资产/知识/地点：{"name":"名称","description":"描述","owner":"所属者"}`
- **示例**：`更新物品：{"name":"神秘钥匙","description":"一把古老的钥匙，似乎可以打开某个秘密通道","owner":"主角"}`

#### 移除物品/资产/知识/地点
- **格式**：`移除物品/资产/知识/地点：名称`
- **示例**：`移除物品：神秘钥匙`

### 2.9 成就操作

管理游戏中的成就。

#### 完成成就
- **格式**：`完成成就：成就名称`
- **示例**：`完成成就：发现神秘地下室`

#### 显示成就
- **格式**：`显示成就：成就名称`
- **示例**：`显示成就：首次发现线索`

## 3. 输出格式要求

1. **指令清晰**：每个指令应单独成行，避免与故事内容混淆
2. **JSON格式正确**：对于需要JSON数据的指令，确保JSON格式正确
3. **必填字段完整**：根据指令类型，确保所有必填字段都已提供
4. **符合验证规则**：所有指令应符合`validateRequest`方法的验证规则

## 4. 解析流程

1. `responseParser.parseResponse()` 作为入口，接收完整响应
2. `responseParser.extractParts()` 提取故事部分和数据请求部分
3. `responseParser.parseDataRequests()` 解析每个数据请求
4. `responseParser.validateRequest()` 验证每个请求的格式
5. 验证通过的请求被发送到游戏引擎执行

## 5. 示例输出

```
当前景深等级：3
推进时间：2小时
注册事件：{"name":"神秘会议","description":"主角参加了一个神秘会议","expectedEndTime":"1925-12-26 23:00:00","status":"foreground","importance":3,"participants":["主角","神秘人"]}
添加物品：{"name":"神秘文件","description":"会议中获得的神秘文件","owner":"主角"}
节拍操作：推进节拍
```

## 6. 注意事项

1. 所有指令应基于故事内容生成，确保游戏状态与故事发展保持一致
2. 合理使用各种操作，避免不必要的状态更新
3. 确保时间推进的合理性，保持时间线的连贯性
4. 重点事件和伏笔应及时记录，以便后续故事发展使用
5. 定期清理不再需要的事件和伏笔，保持游戏状态的简洁性